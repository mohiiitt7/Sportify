<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt #{{ sale.bill_id }} - Sportify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Courier New', Courier, monospace;
        }

        .receipt-container {
            max-width: 400px;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-top: 5px solid #1976D2;
        }

        .receipt-header {
            text-align: center;
            border-bottom: 2px dashed #ddd;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .receipt-logo {
            font-size: 24px;
            font-weight: bold;
            color: #1976D2;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .receipt-footer {
            border-top: 2px dashed #ddd;
            padding-top: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .totals-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .grand-total {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        .btn-print {
            display: block;
            width: 100%;
            margin-top: 20px;
        }

        @media print {
            body {
                background: #fff;
            }

            .receipt-container {
                box-shadow: none;
                margin: 0;
                border: none;
            }

            .no-print {
                display: none;
            }
        }
    </style>
</head>

<body>

    <div class="receipt-container">
        <div class="receipt-header">
            {% if settings.shop_logo %}
            <div class="mb-2 text-center">
                <img src="{{ settings.shop_logo }}" alt="Logo" style="max-height: 60px; max-width: 100%;">
            </div>
            {% endif %}
            <div class="receipt-logo">{{ settings.shop_name|upper }}</div>
            <div class="text-muted small">{{ settings.shop_address }}</div>
            <div class="text-muted small">Ph: {{ settings.shop_contact }}</div>
            <div class="mt-2"><strong>Receipt #{{ sale.bill_id }}</strong></div>
            <div class="small">{{ sale.bill_date.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>

        <div class="mb-3">
            <div class="small text-muted">Customer Details:</div>
            <div><strong>{{ sale.customer_name }}</strong></div>
            <div>Ph: {{ sale.customer_contact }}</div>
        </div>

        <div class="mb-3">
            <div class="small text-muted mb-2">Items Purchased:</div>
            <table style="width: 100%; font-size: 0.85rem; border-collapse: collapse;">
                <thead style="border-bottom: 1px solid #ddd;">
                    <tr>
                        <th style="text-align: left; padding: 5px 0;">Item</th>
                        <th style="text-align: center;">Qty</th>
                        <th style="text-align: right;">Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% set items_list = sale.items_summary.split(', ') %}
                    {% for item in items_list %}
                    {% set item_parts = item.split(' x') %}
                    {% if item_parts|length >= 2 %}
                    {% set name = item_parts[0] %}
                    {% set qty_price = item_parts[1].split(' (') %}
                    {% set quantity = qty_price[0] if qty_price|length > 0 else '1' %}
                    {% set price = qty_price[1].replace('â‚¹', '').replace(')', '') if qty_price|length > 1 else '0' %}
                    <tr>
                        <td style="padding: 5px 0;">{{ name }}</td>
                        <td style="text-align: center;">{{ quantity }}</td>
                        <td style="text-align: right;">â‚¹{{ price }}</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="receipt-summary">
            <div class="totals-row">
                <span>Subtotal</span>
                <span>â‚¹{{ "%.2f"|format(sale.total_amount) }}</span>
            </div>
            <div class="totals-row text-danger">
                <span>GST (+)</span>
                <span>â‚¹{{ "%.2f"|format(sale.gst_amount) }}</span>
            </div>
            <div class="totals-row text-success">
                <span>Discount (-)</span>
                <span>â‚¹{{ "%.2f"|format(sale.discount_amount) }}</span>
            </div>
            <div class="totals-row grand-total">
                <span>TOTAL</span>
                <span>â‚¹{{ "%.2f"|format(sale.net_amount) }}</span>
            </div>
        </div>

        <!-- Payment Details Section -->
        <div class="mt-3 pt-3 border-top">
            <div class="small text-muted mb-2">Payment Details:</div>
            <div class="item-row">
                <span>Payment Method:</span>
                <strong>
                    {% if sale.payment_method == 'UPI' %}
                    <span class="text-primary">ðŸ’³ UPI</span>
                    {% elif sale.payment_method == 'Card' %}
                    <span class="text-info">ðŸ’³ Card</span>
                    {% else %}
                    <span class="text-success">ðŸ’µ Cash</span>
                    {% endif %}
                </strong>
            </div>

            {% if sale.transaction_id %}
            <div class="item-row small">
                <span>Transaction ID:</span>
                <span>{{ sale.transaction_id }}</span>
            </div>
            {% endif %}

            {% if sale.upi_id %}
            <div class="item-row small">
                <span>UPI ID:</span>
                <span>{{ sale.upi_id }}</span>
            </div>
            {% endif %}

            {% if sale.card_last4 %}
            <div class="item-row small">
                <span>Card (Last 4):</span>
                <span>**** {{ sale.card_last4 }}</span>
            </div>
            {% endif %}

            <div class="item-row small">
                <span>Status:</span>
                <span class="badge bg-success">{{ sale.payment_status }}</span>
            </div>
        </div>

        <div class="receipt-footer">
            <div class="small">Thank you for shopping with us!</div>
            <div class="small text-muted mt-1">No refunds</div>
        </div>

        <div class="no-print mt-4">
            <button onclick="window.print()" class="btn btn-success btn-print fw-bold">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-file-earmark-pdf-fill me-2" viewBox="0 0 16 16">
                    <path
                        d="M5.523 12.424c.14-.082.293-.162.459-.238a7.878 7.878 0 0 1-.45.606c-.28.337-.498.516-.635.572a.266.266 0 0 1-.035.012.282.282 0 0 1-.026-.044c-.056-.11-.054-.216.04-.36.106-.165.319-.356.647-.548zm2.455-1.647c-.119.025-.237.05-.356.078a21.148 21.148 0 0 0 .5-1.05 12.045 12.045 0 0 0 .51.858c-.217.032-.436.07-.654.114zm2.525.939a3.881 3.881 0 0 1-.435-.41c.228.005.434.02.612.054.317.057.466.147.518.209a.095.095 0 0 1 .026.064.436.436 0 0 1-.06.2.307.307 0 0 1-.094.124.107.107 0 0 1-.069.015c-.09-.003-.258-.066-.498-.256zM8.278 6.97c-.04.244-.108.524-.2.829a4.86 4.86 0 0 1-.089-.346c-.076-.353-.087-.63-.046-.822.038-.177.11-.248.196-.283a.517.517 0 0 1 .145-.04c.013.03.028.092.032.198.005.122-.007.277-.038.465z" />
                    <path fill-rule="evenodd"
                        d="M4 0h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm5.5 1.5v2a1 1 0 0 0 1 1h2l-3-3zM4.165 13.668c.09.18.23.343.438.419.207.075.412.04.58-.03.318-.13.635-.436.926-.786.333-.401.683-.927 1.021-1.51a11.651 11.651 0 0 1 1.997-.406c.342.38.737.997 1.012 1.234.138.118.292.192.465.23.174.038.35-.008.472-.112a.606.606 0 0 0 .154-.19l.107-.251a1.056 1.056 0 0 0-.01-.708 3.568 3.568 0 0 0-.693-1.05c-.642-.7-1.742-1.258-3.085-1.42a25.541 25.541 0 0 0-1.898-1.55c.29-.861.43-1.799.27-2.61a2.126 2.126 0 0 0-.584-1.248 1.95 1.95 0 0 0-1.037-.461c-.534-.06-1.077.054-1.428.449-.3.336-.376.8-.2.96.166.151.716.488 1.22 1.353.483.823.58 1.48.513 1.922-.395.747-.905 1.637-1.47 2.274a12.607 12.607 0 0 0-.962.628c-.466.368-.971.848-1.026 1.489-.057.671.36 1.194.862 1.342z" />
                </svg>
                Download PDF Invoice
            </button>
            <a href="/orders" class="btn btn-outline-secondary btn-print mt-2">Back to Sales History</a>
        </div>
    </div>

</body>

</html>